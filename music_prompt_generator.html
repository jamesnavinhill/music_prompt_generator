<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Prompt Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            background: rgba(26, 34, 50, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 2px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.08);
            overflow-x: auto;
            max-width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #ffffff;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .advanced-controls {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 2px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            overflow: hidden;
        }

        .advanced-controls-header {
            padding: 12px 20px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .advanced-controls-header h3 {
            font-size: 16px;
            color: #a0aec0;
            margin: 0;
        }

        .advanced-controls-content {
            padding: 20px;
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .advanced-controls-content.collapsed {
            display: none;
        }

        .control-panel {
            padding: 0;
            border: none;
            background: none;
            margin: 0;
        }
        
        .style-selector {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .style-selector label {
            font-weight: 600;
            color: #a0aec0;
            font-size: 14px;
        }
        
        .style-selector select {
            padding: 10px 15px;
            border-radius: 2px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            font-size: 14px;
            min-width: 200px;
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px; /* Added margin */
        }
        
        .btn-primary, .btn-secondary, .btn-accent, .btn-danger, .copy-btn, .tab-button {
            padding: 10px 20px;
            border-radius: 2px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 85, 104, 0.4);
            background: linear-gradient(135deg, #5a6578 0%, #3d4758 100%);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: #e2e8f0;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, #805a3b 0%, #6b4730 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(128, 90, 59, 0.3);
        }
        
        .btn-accent:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(128, 90, 59, 0.4);
            background: linear-gradient(135deg, #906a4b 0%, #7b5740 100%);
        }
        
        .btn-danger {
            background: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }
        
        .btn-danger:hover {
            background: rgba(220, 53, 69, 0.3);
            border-color: rgba(220, 53, 69, 0.5);
            transform: translateY(-1px);
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .section-header {
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 12px 16px;
            font-size: 12px;
            letter-spacing: 0.5px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            position: relative;
            opacity: 0.95;
        }
        
        .section-header:hover {
            opacity: 1;
            transform: translateY(-1px);
        }
        
        .section-header.collapsed {
            min-width: auto;
            padding: 12px 20px;
        }
        
        /* Remove vertical text orientation */
        .section-header.collapsed .section-text {
            display: inline-block;
        }
        
        /* Updated section colors - more subtle */
        .section-header.core {
            background: linear-gradient(135deg, rgba(160, 174, 192, 0.25) 0%, rgba(144, 158, 176, 0.2) 100%);
            border-left: 3px solid #a0aec0;
        }
        .section-header.rhythm {
            background: linear-gradient(135deg, rgba(160, 135, 109, 0.25) 0%, rgba(144, 119, 93, 0.2) 100%);
            border-left: 3px solid #a0876d;
        }
        .section-header.bass {
            background: linear-gradient(135deg, rgba(74, 85, 104, 0.25) 0%, rgba(58, 69, 88, 0.2) 100%);
            border-left: 3px solid #4a5568;
        }
        .section-header.melodic {
            background: linear-gradient(135deg, rgba(113, 128, 150, 0.25) 0%, rgba(97, 112, 134, 0.2) 100%);
            border-left: 3px solid #718096;
        }
        .section-header.texture {
            background: linear-gradient(135deg, rgba(128, 90, 59, 0.25) 0%, rgba(112, 74, 43, 0.2) 100%);
            border-left: 3px solid #805a3b;
        }
        .section-header.production {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.25) 0%, rgba(28, 46, 64, 0.2) 100%);
            border-left: 3px solid #2c3e50;
        }
        
        .toggle-icon {
            display: inline-block;
            margin-right: 8px;
            font-size: 14px;
            transition: transform 0.3s ease;
        }
        
        .section-header.collapsed .toggle-icon {
            transform: rotate(0deg);
        }
        
        .column-header {
            background-color: rgba(255, 255, 255, 0.04);
            color: #a0aec0;
            font-weight: 600;
            text-align: center;
            padding: 10px 6px;
            font-size: 11px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            line-height: 1.2;
        }
        
        .column-header.hidden {
            display: none;
        }
        
        .style-cell {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            font-weight: 600;
            color: #e2e8f0;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            text-align: left;
        }
        
        .data-cell {
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            text-align: center;
            background-color: rgba(0, 0, 0, 0.15);
            min-width: 100px;
        }
        
        .data-cell.hidden {
            display: none;
        }
        
        select {
            width: 100%;
            padding: 6px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 2px;
            background-color: rgba(0, 0, 0, 0.4);
            color: #ffffff;
            font-size: 11px;
            transition: all 0.3s ease;
        }
        
        select:hover {
            border-color: rgba(113, 128, 150, 0.5);
            background-color: rgba(0, 0, 0, 0.6);
        }
        
        select:focus {
            outline: none;
            border-color: #718096;
            box-shadow: 0 0 0 2px rgba(113, 128, 150, 0.15);
        }
        
        select option {
            background-color: #1a1a2e;
            color: #ffffff;
        }
        
        /* Output styles */
        .clean-prompt {
            background: linear-gradient(135deg, rgba(74, 85, 104, 0.15) 0%, rgba(74, 85, 104, 0.08) 100%);
            border: 2px solid #4a5568;
            padding: 20px;
            border-radius: 2px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 4px 15px rgba(74, 85, 104, 0.15);
        }
        
        .clean-prompt h3 {
            margin: 0 0 15px 0;
            color: #cbd5e0;
            font-size: 16px;
            font-weight: bold;
        }
        
        .clean-prompt-text {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e2e8f0;
            word-wrap: break-word;
            background: rgba(0, 0, 0, 0.25);
            padding: 15px;
            border-radius: 2px;
            border: 1px solid rgba(74, 85, 104, 0.3);
        }
        
        .copy-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            border: none;
        }
        
        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.3);
        }
        
        .copy-btn.copied {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .detailed-breakdown {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 2px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        .detailed-breakdown h3 {
            margin: 0 0 15px 0;
            color: #a0aec0;
            font-size: 16px;
            font-weight: bold;
        }
        
        #detailedBreakdown {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
            color: #cbd5e0;
            white-space: pre-wrap;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 2px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            margin: 25px 0;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 2px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(113, 128, 150, 0.4);
            border-radius: 2px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(113, 128, 150, 0.6);
        }
        
        /* Phase 2: Collapsible Sections Enhancement */
        .toggle-icon {
            display: inline-block;
            transition: transform 300ms ease;
            margin-right: 6px;
            font-size: 12px;
        }
        
        .toggle-icon.rotated {
            transform: rotate(-90deg);
        }
        
        /* Selection badges for collapsed sections */
        .selection-badge {
            display: inline-block;
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 11px;
            margin-left: 8px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.9; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }
        
        /* Focus mode button */
        .focus-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.08);
            color: #a0aec0;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 2px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            opacity: 0;
            transition: all 200ms ease;
            pointer-events: none;
        }
        
        .section-header:hover .focus-btn {
            opacity: 1;
            pointer-events: auto;
        }
        
        .focus-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            color: #cbd5e0;
            transform: translateY(-50%) translateX(-2px);
        }
        
        /* Smooth transitions for section content */
        .column-header, .data-cell {
            transition: opacity 300ms ease, visibility 300ms ease;
        }
        
        .column-header.hidden, .data-cell.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        /* Enhanced section header styling */
        .section-header {
            position: relative;
            transition: all 300ms ease;
        }
        
        .section-header.collapsed {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .section-header.expanded {
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Focus mode active state */
        .focus-mode-active .section-header:not(.focused) {
            opacity: 0.6;
        }
        
        .section-header.focused {
            background: linear-gradient(135deg, rgba(74, 85, 104, 0.3) 0%, rgba(45, 55, 72, 0.25) 100%);
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.2);
        }
        
        /* Tab Navigation Styles */
        .tab-navigation {
            display: flex;
            gap: 8px;
            margin-bottom: 0; /* Attached to table */
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 2px 2px 0 0; /* Sharpened top corners */
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-bottom: none; /* Remove bottom border */
            overflow-x: auto;
            overflow-y: hidden;
            scroll-behavior: smooth;
            position: relative;
        }
        
        .tab-button {
            background: rgba(255, 255, 255, 0.05);
            color: #a0aec0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            white-space: nowrap;
            min-width: fit-content;
            position: relative;
            outline: none;
        }
        
        .tab-button:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #cbd5e0;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            border-color: #4a5568;
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.3);
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 20%;
            right: 20%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #718096, transparent);
            animation: shimmer 2s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .tab-button:focus-visible {
            outline: 2px solid #718096;
            outline-offset: 2px;
        }
        
        /* Row visibility for tabs */
        tbody tr {
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform-origin: center;
        }
        
        tbody tr.tab-hidden {
            display: none;
            opacity: 0;
            transform: scale(0.98);
        }
        
        tbody tr.tab-visible {
            display: table-row;
            opacity: 1;
            transform: scale(1);
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .tab-navigation {
                padding: 10px 8px;
                gap: 6px;
            }
            
            .tab-button {
                padding: 12px 16px;
                font-size: 13px;
                min-height: 44px; /* Touch-friendly size */
            }
            
            /* Scroll indicators */
            .tab-navigation::before,
            .tab-navigation::after {
                content: '';
                position: absolute;
                top: 0;
                bottom: 0;
                width: 20px;
                pointer-events: none;
                z-index: 1;
            }
            
            .tab-navigation::before {
                left: 0;
                background: linear-gradient(90deg, rgba(26, 34, 50, 0.95), transparent);
            }
            
            .tab-navigation::after {
                right: 0;
                background: linear-gradient(270deg, rgba(26, 34, 50, 0.95), transparent);
            }
        }
        
        /* Animation for tab switching */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        tbody tr.fade-in {
            animation: fadeIn 0.3s ease forwards;
        }

        .fusion-toggles {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .fusion-toggles label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 2px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .fusion-toggles label:hover {
            background: rgba(0,0,0,0.4);
        }

        .fusion-toggles input {
            width: 16px;
            height: 16px;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Music Prompt Generator</h1>
        
        <div class="advanced-controls">
            <div class="advanced-controls-header" onclick="toggleAdvancedControls()">
                <h3>Advanced Controls & Fusion</h3>
                <span class="toggle-icon"></span>
            </div>
            <div class="advanced-controls-content collapsed">
                <div class="control-panel">
                    <h4>Style Preset Generator</h4>
                    <div class="style-selector">
                        <label for="styleSelect">Select Style:</label>
                        <select id="styleSelect">
                            <option value="">Choose a style...</option>
                            <option value="random">Random</option>
                            <option value="chillhop">Chillhop</option>
                            <option value="lofi">Lo-Fi</option>
                            <option value="neo-soul">Neo-Soul</option>
                            <option value="rnb">R&B</option>
                            <option value="hiphop">Hip-Hop</option>
                            <option value="gospel">Gospel</option>
                            <option value="edm">EDM</option>
                        </select>
                        <button class="btn-accent" onclick="generateStylePreset()">Generate from Style</button>
                    </div>
                    <hr style="border-color: rgba(255,255,255,0.1); margin: 20px 0;">
                    <h4>Preset Management</h4>
                    <!-- Preset Management Section -->
                    <div class="preset-section">
                        <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                            <label style="font-weight: 600; color: #a0aec0; font-size: 14px;">Presets:</label>
                            
                            <select id="presetDropdown" style="padding: 10px 15px; border-radius: 2px; border: 1px solid rgba(255, 255, 255, 0.2); background-color: rgba(0, 0, 0, 0.3); color: #ffffff; font-size: 14px; min-width: 200px; cursor: pointer;">
                                <option value="">Select a preset...</option>
                                <optgroup label="Favorites" id="favoritesGroup"></optgroup>
                                <optgroup label="User Presets" id="userPresetsGroup"></optgroup>
                                <optgroup label="Recent History" id="historyGroup"></optgroup>
                            </select>
                            
                            <button class="btn-primary" onclick="showSavePresetModal()">Save Preset</button>
                            <button class="btn-secondary" onclick="loadSelectedPreset()">Load</button>
                            <button class="btn-secondary" onclick="deleteSelectedPreset()">Delete</button>
                            <button class="btn-secondary" onclick="exportPresets()">Export</button>
                            <button class="btn-secondary" onclick="document.getElementById('importFile').click()">Import</button>
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importPresets(event)">
                        </div>
                        
                        <div id="presetInfo" style="margin-top: 10px; font-size: 12px; color: #718096; display: none;">
                            <span id="presetMetadata"></span>
                        </div>
                    </div>
                </div>
                <div class="control-panel">
                    <h4>Style Fusion Generator</h4>
                    <p style="font-size: 12px; color: #a0aec0; margin-bottom: 15px;">Select 2 or 3 styles to fuse together.</p>
                    <div id="fusionStyleToggles" class="fusion-toggles">
                        <!-- Fusion toggles will be populated here -->
                    </div>
                    <button id="generateFusionBtn" class="btn-accent" onclick="generateFusion()" style="margin-top: 15px;" disabled>Generate Fusion</button>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="generatePrompt()">Generate Prompt</button>
            <button class="btn-secondary" onclick="exportToCSV()">Export to CSV</button>
            <button class="btn-secondary" onclick="toggleAllSections()">Expand/Collapse All</button>
            <button class="btn-danger" onclick="clearAll()">Clear All</button>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="all" onclick="toggleStyle('all', this)">All Styles</button>
            <button class="tab-button" data-tab="chillhop" onclick="toggleStyle('chillhop', this)">Chillhop</button>
            <button class="tab-button" data-tab="lofi" onclick="toggleStyle('lofi', this)">Lo-Fi</button>
            <button class="tab-button" data-tab="neo-soul" onclick="toggleStyle('neo-soul', this)">Neo-Soul</button>
            <button class="tab-button" data-tab="rnb" onclick="toggleStyle('rnb', this)">R&B</button>
            <button class="tab-button" data-tab="hiphop" onclick="toggleStyle('hiphop', this)">Hip-Hop</button>
            <button class="tab-button" data-tab="gospel" onclick="toggleStyle('gospel', this)">Gospel</button>
            <button class="tab-button" data-tab="edm" onclick="toggleStyle('edm', this)">EDM</button>
            <button class="tab-button" data-tab="trap" onclick="toggleStyle('trap', this)">Trap</button>
        </div>
        
        <!-- Save Preset Modal -->
        <div id="savePresetModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000;">
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);" onclick="closeSavePresetModal()"></div>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 30px; border-radius: 2px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); min-width: 400px; max-width: 90vw;">
                <h3 style="color: #ffffff; margin-bottom: 20px; font-size: 1.5rem;">Save Preset</h3>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #a0aec0; font-size: 14px; margin-bottom: 8px;">Preset Name:</label>
                    <input type="text" id="presetName" placeholder="Enter preset name..." style="width: 100%; padding: 10px; border-radius: 2px; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(0, 0, 0, 0.3); color: #ffffff; font-size: 14px;" onkeypress="if(event.key === 'Enter') savePreset()">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; color: #a0aec0; font-size: 14px; cursor: pointer;">
                        <input type="checkbox" id="presetFavorite" style="margin-right: 8px;">
                        <span>Add to Favorites</span>
                    </label>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button class="btn-secondary" onclick="closeSavePresetModal()">Cancel</button>
                    <button class="btn-primary" onclick="savePreset()">Save</button>
                </div>
            </div>
        </div>
        
        <!-- Toast Notification Container -->
        <div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 2000;"></div>
        
        <table id="promptMatrix">
            <thead>
                <tr>
                    <th class="style-cell">Style</th>
                    <!-- Core Foundation -->
                    <th class="section-header core collapsed" colspan="4" onclick="toggleSection('core')" data-section="core">
                        <span class="toggle-icon"></span>
                        <span class="section-text">CORE FOUNDATION</span>
                        <span class="selection-badge" style="display: none;">0</span>
                        <button class="focus-btn" onclick="event.stopPropagation(); focusOnSection('core')">Focus</button>
                    </th>
                    <!-- Rhythm Section -->
                    <th class="section-header rhythm collapsed" colspan="5" onclick="toggleSection('rhythm')" data-section="rhythm">
                        <span class="toggle-icon"></span>
                        <span class="section-text">RHYTHM SECTION</span>
                        <span class="selection-badge" style="display: none;">0</span>
                        <button class="focus-btn" onclick="event.stopPropagation(); focusOnSection('rhythm')">Focus</button>
                    </th>
                    <!-- Bass Foundation -->
                    <th class="section-header bass collapsed" colspan="3" onclick="toggleSection('bass')" data-section="bass">
                        <span class="toggle-icon"></span>
                        <span class="section-text">BASS FOUNDATION</span>
                        <span class="selection-badge" style="display: none;">0</span>
                        <button class="focus-btn" onclick="event.stopPropagation(); focusOnSection('bass')">Focus</button>
                    </th>
                    <!-- Melodic Elements -->
                    <th class="section-header melodic collapsed" colspan="4" onclick="toggleSection('melodic')" data-section="melodic">
                        <span class="toggle-icon"></span>
                        <span class="section-text">MELODIC ELEMENTS</span>
                        <span class="selection-badge" style="display: none;">0</span>
                        <button class="focus-btn" onclick="event.stopPropagation(); focusOnSection('melodic')">Focus</button>
                    </th>
                    <!-- Texture & Atmosphere -->
                    <th class="section-header texture collapsed" colspan="4" onclick="toggleSection('texture')" data-section="texture">
                        <span class="toggle-icon"></span>
                        <span class="section-text">TEXTURE & ATMOSPHERE</span>
                        <span class="selection-badge" style="display: none;">0</span>
                        <button class="focus-btn" onclick="event.stopPropagation(); focusOnSection('texture')">Focus</button>
                    </th>
                    <!-- Production & Character -->
                    <th class="section-header production collapsed" colspan="4" onclick="toggleSection('production')" data-section="production">
                        <span class="toggle-icon"></span>
                        <span class="section-text">PRODUCTION & CHARACTER</span>
                        <span class="selection-badge" style="display: none;">0</span>
                        <button class="focus-btn" onclick="event.stopPropagation(); focusOnSection('production')">Focus</button>
                    </th>
                </tr>
                <tr>
                    <th class="style-cell"></th>
                    <!-- Core Foundation -->
                    <th class="column-header core hidden">Genre/Style</th>
                    <th class="column-header core hidden">BPM/Tempo</th>
                    <th class="column-header core hidden">Key/Scale</th>
                    <th class="column-header core hidden">Time Signature</th>
                    <!-- Rhythm Section -->
                    <th class="column-header rhythm hidden">Drum Kit Style</th>
                    <th class="column-header rhythm hidden">Kick Pattern</th>
                    <th class="column-header rhythm hidden">Snare/Clap Style</th>
                    <th class="column-header rhythm hidden">Hi-hat Pattern</th>
                    <th class="column-header rhythm hidden">Percussion Elements</th>
                    <!-- Bass Foundation -->
                    <th class="column-header bass hidden">Bass Type</th>
                    <th class="column-header bass hidden">Bass Pattern/Style</th>
                    <th class="column-header bass hidden">Bass Tone/Character</th>
                    <!-- Melodic Elements -->
                    <th class="column-header melodic hidden">Lead Instrument</th>
                    <th class="column-header melodic hidden">Chord Progression</th>
                    <th class="column-header melodic hidden">Harmonic Movement</th>
                    <th class="column-header melodic hidden">Secondary Melodic</th>
                    <!-- Texture & Atmosphere -->
                    <th class="column-header texture hidden">Ambient Elements</th>
                    <th class="column-header texture hidden">Vocal Elements</th>
                    <th class="column-header texture hidden">Sound Effects</th>
                    <th class="column-header texture hidden">Spatial Elements</th>
                    <!-- Production & Character -->
                    <th class="column-header production hidden">Mix Style</th>
                    <th class="column-header production hidden">Effects Processing</th>
                    <th class="column-header production hidden">Overall Vibe</th>
                    <th class="column-header production hidden">Era/Time Period</th>
                </tr>
            </thead>
            <tbody>
                <!-- CHILLHOP ROW -->
                <tr data-style="chillhop">
                    <td class="style-cell">Chillhop</td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="chillhop">Chillhop</option><option value="jazzy-chillhop">Jazzy Chillhop</option><option value="ambient-chillhop">Ambient Chillhop</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="70-80">70-80 BPM</option><option value="80-90">80-90 BPM</option><option value="90-100">90-100 BPM</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="C-major">C Major</option><option value="A-minor">A Minor</option><option value="F-major">F Major</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="4/4">4/4</option><option value="6/8">6/8</option><option value="7/8">7/8</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="vintage-acoustic">Vintage Acoustic</option><option value="lo-fi-electronic">Lo-Fi Electronic</option><option value="jazz-brushes">Jazz Brushes</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="laid-back-swing">Laid-back Swing</option><option value="subtle-sidestick">Subtle Sidestick</option><option value="minimal-thump">Minimal Thump</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="crisp-snap">Crisp Snap</option><option value="soft-rim">Soft Rim</option><option value="vinyl-crack">Vinyl Crack</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="open-closed">Open/Closed</option><option value="subtle-swing">Subtle Swing</option><option value="ghost-notes">Ghost Notes</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="shakers">Shakers</option><option value="finger-snaps">Finger Snaps</option><option value="vinyl-crackle">Vinyl Crackle</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="warm-synth">Warm Synth</option><option value="upright-bass">Upright Bass</option><option value="electric-bass">Electric Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="walking-bass">Walking Bass</option><option value="simple-root">Simple Root</option><option value="melodic-runs">Melodic Runs</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="smooth-rounded">Smooth &amp; Rounded</option><option value="warm-analog">Warm Analog</option><option value="deep-woody">Deep &amp; Woody</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="electric-piano">Electric Piano</option><option value="mellow-synth">Mellow Synth</option><option value="jazz-guitar">Jazz Guitar</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="ii-V-I">ii-V-I</option><option value="vi-IV-I-V">vi-IV-I-V</option><option value="modal-jazz">Modal Jazz</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="smooth-voice">Smooth Voice Leading</option><option value="chromatic">Chromatic Movement</option><option value="suspended">Suspended Chords</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="soft-strings">Soft Strings</option><option value="muted-trumpet">Muted Trumpet</option><option value="flute-melody">Flute Melody</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="warm-pads">Warm Pads</option><option value="subtle-strings">Subtle Strings</option><option value="vinyl-texture">Vinyl Texture</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="jazz-vocals">Jazz Vocal Samples</option><option value="spoken-word">Spoken Word</option><option value="no-vocals">No Vocals</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="rain-sounds">Rain Sounds</option><option value="cafe-ambience">Cafe Ambience</option><option value="vinyl-pops">Vinyl Pops</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="warm-reverb">Warm Reverb</option><option value="stereo-wide">Stereo Wide</option><option value="intimate-close">Intimate Close</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="clean-warm">Clean &amp; Warm</option><option value="lo-fi-dusty">Lo-Fi Dusty</option><option value="vintage-analog">Vintage Analog</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="tape-saturation">Tape Saturation</option><option value="subtle-compression">Subtle Compression</option><option value="analog-warmth">Analog Warmth</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="relaxed-chill">Relaxed &amp; Chill</option><option value="contemplative">Contemplative</option><option value="nostalgic">Nostalgic</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="90s-jazz">90s Jazz</option><option value="modern-chill">Modern Chill</option><option value="vintage-soul">Vintage Soul</option></select></td>
                </tr>
                
                <!-- LO-FI ROW -->
                <tr data-style="lofi">
                    <td class="style-cell">Lo-Fi</td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="lo-fi-hiphop">Lo-Fi Hip-Hop</option><option value="dusty-lofi">Dusty Lo-Fi</option><option value="bedroom-lofi">Bedroom Lo-Fi</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="60-70">60-70 BPM</option><option value="70-80">70-80 BPM</option><option value="80-90">80-90 BPM</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="D-minor">D Minor</option><option value="F-major">F Major</option><option value="Bb-major">Bb Major</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="4/4">4/4</option><option value="swing-4/4">Swing 4/4</option><option value="half-time">Half-Time</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="dusty-vinyl">Dusty Vinyl</option><option value="analog-drum-machine">Analog Drum Machine</option><option value="tape-saturated">Tape Saturated</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="muffled-thump">Muffled Thump</option><option value="vintage-808">Vintage 808</option><option value="cardboard-kick">Cardboard Kick</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="dusty-snap">Dusty Snap</option><option value="muted-clap">Muted Clap</option><option value="cardboard-snare">Cardboard Snare</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="crackling-hats">Crackling Hi-Hats</option><option value="lo-fi-shuffle">Lo-Fi Shuffle</option><option value="vinyl-hiss">Vinyl Hiss</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="record-crackle">Record Crackle</option><option value="dusty-shakers">Dusty Shakers</option><option value="tape-hiss">Tape Hiss</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="warm-808">Warm 808</option><option value="muffled-synth">Muffled Synth Bass</option><option value="analog-sub">Analog Sub</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="simple-boom-bap">Simple Boom-Bap</option><option value="lazy-groove">Lazy Groove</option><option value="off-beat-bass">Off-Beat Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="saturated-warm">Saturated &amp; Warm</option><option value="muffled-deep">Muffled &amp; Deep</option><option value="analog-fuzzy">Analog Fuzzy</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="dusty-piano">Dusty Piano</option><option value="warm-rhodes">Warm Rhodes</option><option value="vintage-synth">Vintage Synth</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="simple-triads">Simple Triads</option><option value="jazz-extensions">Jazz Extensions</option><option value="modal-minor">Modal Minor</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="lazy-voice-leading">Lazy Voice Leading</option><option value="vintage-modulation">Vintage Modulation</option><option value="tape-flutter">Tape Flutter</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="dusty-guitar">Dusty Guitar</option><option value="lo-fi-bells">Lo-Fi Bells</option><option value="vintage-horns">Vintage Horns</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="analog-strings">Analog Strings</option><option value="dusty-atmosphere">Dusty Atmosphere</option><option value="tape-saturation">Tape Saturation</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="vinyl-vocal-chops">Vinyl Vocal Chops</option><option value="dusty-samples">Dusty Samples</option><option value="minimal-vocals">Minimal Vocals</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="vinyl-crackle">Vinyl Crackle</option><option value="room-tone">Room Tone</option><option value="analog-hiss">Analog Hiss</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="analog-saturation">Analog Saturation</option><option value="muffled-space">Muffled Space</option><option value="vintage-mono">Vintage Mono</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="dusty-vintage">Dusty Vintage</option><option value="analog-compressed">Analog Compressed</option><option value="tape-warped">Tape Warped</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="analog-distortion">Analog Distortion</option><option value="tape-compression">Tape Compression</option><option value="vintage-eq">Vintage EQ</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="dreamy-nostalgic">Dreamy &amp; Nostalgic</option><option value="melancholic">Melancholic</option><option value="cozy-intimate">Cozy &amp; Intimate</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="90s-hiphop">90s Hip-Hop</option><option value="vintage-bedroom">Vintage Bedroom</option><option value="dusty-vinyl">Dusty Vinyl Era</option></select></td>
                </tr>
                
                <!-- NEO-SOUL ROW -->
                <tr data-style="neo-soul">
                    <td class="style-cell">Neo-Soul</td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="neo-soul">Neo-Soul</option><option value="alternative-soul">Alternative Soul</option><option value="contemporary-soul">Contemporary Soul</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="85-95">85-95 BPM</option><option value="95-105">95-105 BPM</option><option value="105-115">105-115 BPM</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="E-minor">E Minor</option><option value="A-major">A Major</option><option value="D-major">D Major</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="4/4">4/4</option><option value="neo-soul-swing">Neo-Soul Swing</option><option value="6/8">6/8</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="live-acoustic">Live Acoustic</option><option value="hybrid-electronic">Hybrid Electronic</option><option value="vintage-ludwig">Vintage Ludwig</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="neo-soul-groove">Neo-Soul Groove</option><option value="syncopated-kick">Syncopated Kick</option><option value="ghost-kick">Ghost Kick</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="fat-snare">Fat Snare</option><option value="rim-click">Rim Click</option><option value="layered-clap">Layered Clap</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="complex-hats">Complex Hi-Hats</option><option value="neo-shuffle">Neo Shuffle</option><option value="crisp-16ths">Crisp 16ths</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="live-percussion">Live Percussion</option><option value="congas-bongos">Congas &amp; Bongos</option><option value="tambourine-accents">Tambourine Accents</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="fender-bass">Fender Bass</option><option value="synth-bass">Synth Bass</option><option value="upright-bass">Upright Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="syncopated-groove">Syncopated Groove</option><option value="melodic-bass">Melodic Bass</option><option value="pocket-playing">Pocket Playing</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="punchy-round">Punchy &amp; Round</option><option value="warm-tube">Warm Tube</option><option value="vintage-moog">Vintage Moog</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="fender-rhodes">Fender Rhodes</option><option value="wurlitzer">Wurlitzer</option><option value="neo-soul-guitar">Neo-Soul Guitar</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="complex-jazz">Complex Jazz</option><option value="extended-chords">Extended Chords</option><option value="altered-dominants">Altered Dominants</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="sophisticated">Sophisticated Movement</option><option value="chromatic-bass">Chromatic Bass Movement</option><option value="modal-interchange">Modal Interchange</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="live-strings">Live Strings</option><option value="horn-section">Horn Section</option><option value="gospel-organ">Gospel Organ</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="lush-strings">Lush Strings</option><option value="warm-organ">Warm Organ</option><option value="analog-pads">Analog Pads</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="soulful-vocals">Soulful Vocals</option><option value="gospel-harmonies">Gospel Harmonies</option><option value="ad-libs">Ad-libs</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="studio-ambience">Studio Ambience</option><option value="room-reverb">Room Reverb</option><option value="vinyl-texture">Vinyl Texture</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="studio-space">Studio Space</option><option value="analog-reverb">Analog Reverb</option><option value="wide-stereo">Wide Stereo</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="warm-analog">Warm Analog</option><option value="live-studio">Live Studio</option><option value="vintage-console">Vintage Console</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="analog-compression">Analog Compression</option><option value="tube-saturation">Tube Saturation</option><option value="tape-delay">Tape Delay</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="soulful-smooth">Soulful &amp; Smooth</option><option value="sophisticated">Sophisticated</option><option value="emotional-deep">Emotional &amp; Deep</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="90s-soul">90s Soul</option><option value="2000s-neo">2000s Neo</option><option value="classic-motown">Classic Motown</option></select></td>
                </tr>
                
                <!-- R&B ROW -->
                <tr data-style="rnb">
                    <td class="style-cell">R&B</td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="contemporary-rnb">Contemporary R&B</option><option value="classic-rnb">Classic R&B</option><option value="alt-rnb">Alt R&B</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="90-100">90-100 BPM</option><option value="100-110">100-110 BPM</option><option value="110-120">110-120 BPM</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="Bb-major">Bb Major</option><option value="G-minor">G Minor</option><option value="Eb-major">Eb Major</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="4/4">4/4</option><option value="rnb-swing">R&B Swing</option><option value="half-time-shuffle">Half-Time Shuffle</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="tight-punchy">Tight &amp; Punchy</option><option value="808-hybrid">808 Hybrid</option><option value="live-drums">Live Drums</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="punchy-808">Punchy 808</option><option value="sub-heavy">Sub Heavy</option><option value="syncopated-pattern">Syncopated Pattern</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="crisp-clap">Crisp Clap</option><option value="layered-snare">Layered Snare</option><option value="tight-snap">Tight Snap</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="modern-hats">Modern Hi-Hats</option><option value="trap-influenced">Trap Influenced</option><option value="classic-rnb">Classic R&B</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="percussion-fills">Percussion Fills</option><option value="shakers">Shakers</option><option value="finger-snaps">Finger Snaps</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="sub-bass">Sub Bass</option><option value="analog-synth">Analog Synth</option><option value="electric-bass">Electric Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="modern-groove">Modern Groove</option><option value="syncopated-funk">Syncopated Funk</option><option value="smooth-pocket">Smooth Pocket</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="deep-punchy">Deep &amp; Punchy</option><option value="warm-tube">Warm Tube</option><option value="modern-clean">Modern Clean</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="modern-keys">Modern Keys</option><option value="vintage-rhodes">Vintage Rhodes</option><option value="smooth-guitar">Smooth Guitar</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="contemporary">Contemporary</option><option value="gospel-influenced">Gospel Influenced</option><option value="jazzy-extensions">Jazzy Extensions</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="smooth-transitions">Smooth Transitions</option><option value="modern-voicing">Modern Voicing</option><option value="soulful-movement">Soulful Movement</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="smooth-synths">Smooth Synths</option><option value="vocal-harmonies">Vocal Harmonies</option><option value="string-section">String Section</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="lush-pads">Lush Pads</option><option value="smooth-strings">Smooth Strings</option><option value="warm-atmosphere">Warm Atmosphere</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="lead-vocals">Lead Vocals</option><option value="harmony-stacks">Harmony Stacks</option><option value="vocal-runs">Vocal Runs</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="studio-polish">Studio Polish</option><option value="breath-sounds">Breath Sounds</option><option value="subtle-fx">Subtle FX</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="polished-space">Polished Space</option><option value="modern-reverb">Modern Reverb</option><option value="intimate-vocals">Intimate Vocals</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="modern-polish">Modern Polish</option><option value="vintage-warmth">Vintage Warmth</option><option value="contemporary-mix">Contemporary Mix</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="modern-compression">Modern Compression</option><option value="vocal-processing">Vocal Processing</option><option value="subtle-autotune">Subtle Auto-tune</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="smooth-sensual">Smooth &amp; Sensual</option><option value="emotional-powerful">Emotional &amp; Powerful</option><option value="contemporary-cool">Contemporary Cool</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="90s-rnb">90s R&B</option><option value="2000s-smooth">2000s Smooth</option><option value="modern-rnb">Modern R&B</option></select></td>
                </tr>
                
                <!-- HIP-HOP ROW -->
                <tr data-style="hiphop">
                    <td class="style-cell">Hip-Hop</td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="boom-bap">Boom Bap</option><option value="trap">Trap</option><option value="conscious-hiphop">Conscious Hip-Hop</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="85-95">85-95 BPM</option><option value="130-140">130-140 BPM (Trap)</option><option value="90-100">90-100 BPM</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="C-minor">C Minor</option><option value="E-minor">E Minor</option><option value="F#-minor">F# Minor</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="4/4">4/4</option><option value="trap-timing">Trap Timing</option><option value="boom-bap-swing">Boom Bap Swing</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="punchy-sampled">Punchy Sampled</option><option value="808-heavy">808 Heavy</option><option value="vintage-breaks">Vintage Breaks</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="booming-808">Booming 808</option><option value="punchy-kick">Punchy Kick</option><option value="sub-heavy-kick">Sub Heavy Kick</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="crisp-snare">Crisp Snare</option><option value="trap-snare">Trap Snare</option><option value="vintage-break">Vintage Break</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="trap-rolls">Trap Rolls</option><option value="classic-hats">Classic Hi-Hats</option><option value="open-hats">Open Hats</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="vocal-chops">Vocal Chops</option><option value="vinyl-scratches">Vinyl Scratches</option><option value="percussion-hits">Percussion Hits</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="deep-808">Deep 808</option><option value="synth-bass">Synth Bass</option><option value="sampled-bass">Sampled Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="simple-pattern">Simple Pattern</option><option value="sliding-808s">Sliding 808s</option><option value="syncopated-bass">Syncopated Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="sub-heavy">Sub Heavy</option><option value="distorted-808">Distorted 808</option><option value="vintage-bass">Vintage Bass</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="dark-synths">Dark Synths</option><option value="piano-samples">Piano Samples</option><option value="brass-stabs">Brass Stabs</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="simple-loops">Simple Loops</option><option value="minor-progressions">Minor Progressions</option><option value="modal-dark">Modal Dark</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="minimal-changes">Minimal Changes</option><option value="dramatic-drops">Dramatic Drops</option><option value="tension-building">Tension Building</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="string-hits">String Hits</option><option value="vocal-samples">Vocal Samples</option><option value="orchestral-stabs">Orchestral Stabs</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="dark-atmosphere">Dark Atmosphere</option><option value="urban-textures">Urban Textures</option><option value="minimal-pads">Minimal Pads</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="rap-vocals">Rap Vocals</option><option value="vocal-samples">Vocal Samples</option><option value="ad-libs">Ad-libs</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="vinyl-crackle">Vinyl Crackle</option><option value="urban-ambience">Urban Ambience</option><option value="tape-stops">Tape Stops</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="wide-stereo">Wide Stereo</option><option value="punchy-mono">Punchy Mono</option><option value="spatial-effects">Spatial Effects</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="hard-punchy">Hard &amp; Punchy</option><option value="lo-fi-dusty">Lo-Fi Dusty</option><option value="modern-clean">Modern Clean</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="heavy-compression">Heavy Compression</option><option value="distortion">Distortion</option><option value="vinyl-simulation">Vinyl Simulation</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="aggressive-hard">Aggressive &amp; Hard</option><option value="dark-moody">Dark &amp; Moody</option><option value="melancholic-and-wavy">Melancholic and Wavy</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="2010s-trap">2010s Trap</option><option value="modern-soundcloud">Modern Soundcloud</option><option value="future-trap">Future Trap</option></select></td>
                </tr>
                
                <!-- GOSPEL ROW -->
                <tr data-style="gospel">
                    <td class="style-cell">Gospel</td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="traditional-gospel">Traditional Gospel</option><option value="contemporary-gospel">Contemporary Gospel</option><option value="neo-gospel">Neo Gospel</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="100-110">100-110 BPM</option><option value="110-120">110-120 BPM</option><option value="120-130">120-130 BPM</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="Ab-major">Ab Major</option><option value="Db-major">Db Major</option><option value="F-major">F Major</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="4/4">4/4</option><option value="gospel-shuffle">Gospel Shuffle</option><option value="12/8">12/8</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="live-acoustic">Live Acoustic</option><option value="punchy-modern">Punchy Modern</option><option value="vintage-gospel">Vintage Gospel</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="gospel-chops">Gospel Chops</option><option value="four-on-floor">Four on Floor</option><option value="syncopated-gospel">Syncopated Gospel</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="backbeat-snare">Backbeat Snare</option><option value="gospel-fills">Gospel Fills</option><option value="rim-click-accent">Rim Click Accent</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="driving-16ths">Driving 16ths</option><option value="gospel-chops">Gospel Chops</option><option value="shuffle-hats">Shuffle Hi-Hats</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="live-percussion">Live Percussion</option><option value="tambourine">Tambourine</option><option value="hand-claps">Hand Claps</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="electric-bass">Electric Bass</option><option value="synth-bass">Synth Bass</option><option value="upright-bass">Upright Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="gospel-walking">Gospel Walking</option><option value="root-fifth">Root-Fifth</option><option value="melodic-gospel">Melodic Gospel</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="warm-punchy">Warm &amp; Punchy</option><option value="vintage-tube">Vintage Tube</option><option value="modern-tight">Modern Tight</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="hammond-organ">Hammond Organ</option><option value="gospel-piano">Gospel Piano</option><option value="electric-piano">Electric Piano</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="gospel-progressions">Gospel Progressions</option><option value="church-chords">Church Chords</option><option value="extended-harmony">Extended Harmony</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="gospel-runs">Gospel Runs</option><option value="passing-chords">Passing Chords</option><option value="chromatic-gospel">Chromatic Gospel</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="gospel-organ">Gospel Organ</option><option value="brass-section">Brass Section</option><option value="string-section">String Section</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="church-atmosphere">Church Atmosphere</option><option value="warm-reverb">Warm Reverb</option><option value="inspirational-pads">Inspirational Pads</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="gospel-choir">Gospel Choir</option><option value="lead-vocals">Lead Vocals</option><option value="call-response">Call &amp; Response</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="church-reverb">Church Reverb</option><option value="congregation">Congregation</option><option value="organ-leslie">Organ Leslie</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="church-space">Church Space</option><option value="cathedral-reverb">Cathedral Reverb</option><option value="intimate-worship">Intimate Worship</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="live-church">Live Church</option><option value="vintage-gospel">Vintage Gospel</option><option value="modern-worship">Modern Worship</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="analog-warmth">Analog Warmth</option><option value="tube-compression">Tube Compression</option><option value="vintage-reverb">Vintage Reverb</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="uplifting-joyful">Uplifting &amp; Joyful</option><option value="spiritual-moving">Spiritual &amp; Moving</option><option value="celebratory">Celebratory</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="classic-gospel">Classic Gospel</option><option value="90s-contemporary">90s Contemporary</option><option value="modern-worship">Modern Worship</option></select></td>
                </tr>
                
                <!-- EDM ROW -->
                <tr data-style="edm">
                    <td class="style-cell">EDM</td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="house">House</option><option value="progressive-house">Progressive House</option><option value="deep-house">Deep House</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="120-128">120-128 BPM</option><option value="128-132">128-132 BPM</option><option value="132-140">132-140 BPM</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="A-minor">A Minor</option><option value="C-major">C Major</option><option value="G-minor">G Minor</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="4/4">4/4</option><option value="straight-4/4">Straight 4/4</option><option value="dance-timing">Dance Timing</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="electronic-punchy">Electronic Punchy</option><option value="layered-samples">Layered Samples</option><option value="analog-drums">Analog Drums</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="four-on-floor">Four on Floor</option><option value="deep-house-kick">Deep House Kick</option><option value="punchy-dance">Punchy Dance</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="clap-snare">Clap &amp; Snare</option><option value="layered-percussion">Layered Percussion</option><option value="analog-snare">Analog Snare</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="closed-open">Closed/Open Pattern</option><option value="driving-16ths">Driving 16ths</option><option value="filtered-hats">Filtered Hi-Hats</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="percussion-loops">Percussion Loops</option><option value="ethnic-percussion">Ethnic Percussion</option><option value="electronic-hits">Electronic Hits</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="deep-sub">Deep Sub</option><option value="synth-bass">Synth Bass</option><option value="reese-bass">Reese Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="simple-pattern">Simple Pattern</option><option value="driving-bass">Driving Bass</option><option value="melodic-bass">Melodic Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="deep-sub">Deep Sub</option><option value="warm-analog">Warm Analog</option><option value="distorted-bass">Distorted Bass</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="lead-synth">Lead Synth</option><option value="pluck-synth">Pluck Synth</option><option value="arp-synth">Arp Synth</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="simple-house">Simple House</option><option value="progressive-build">Progressive Build</option><option value="minor-emotional">Minor Emotional</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="filter-sweeps">Filter Sweeps</option><option value="build-ups">Build-ups</option><option value="tension-drops">Tension &amp; Drops</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="arpeggios">Arpeggios</option><option value="stab-chords">Stab Chords</option><option value="pad-layers">Pad Layers</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="atmospheric-pads">Atmospheric Pads</option><option value="sweep-fx">Sweep FX</option><option value="ambient-layers">Ambient Layers</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="vocal-chops">Vocal Chops</option><option value="dance-vocals">Dance Vocals</option><option value="pitched-vocals">Pitched Vocals</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="risers-sweeps">Risers &amp; Sweeps</option><option value="white-noise">White Noise</option><option value="impact-hits">Impact Hits</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="wide-stereo">Wide Stereo</option><option value="dance-reverb">Dance Reverb</option><option value="club-space">Club Space</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="loud-punchy">Loud &amp; Punchy</option><option value="clean-digital">Clean Digital</option><option value="analog-warmth">Analog Warmth</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="sidechain-compression">Sidechain Compression</option><option value="filter-automation">Filter Automation</option><option value="reverb-delays">Reverb &amp; Delays</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="energetic-uplifting">Energetic &amp; Uplifting</option><option value="emotional-progressive">Emotional Progressive</option><option value="dance-euphoric">Dance Euphoric</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="90s-house">90s House</option><option value="2000s-progressive">2000s Progressive</option><option value="modern-edm">Modern EDM</option></select></td>
                </tr>
                 <!-- TRAP ROW -->
                <tr data-style="trap">
                    <td class="style-cell">Trap</td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="classic-trap">Classic Trap</option><option value="melodic-trap">Melodic Trap</option><option value="hardwave">Hardwave</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="130-140">130-140 BPM</option><option value="140-150">140-150 BPM</option><option value="150-160">150-160 BPM</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="C#-minor">C# Minor</option><option value="F-minor">F Minor</option><option value="G#-minor">G# Minor</option></select></td>
                    <td class="data-cell core hidden"><select><option value="">Select...</option><option value="4/4">4/4</option><option value="half-time">Half-Time</option><option value="double-time">Double-Time</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="heavy-808">Heavy 808 Kit</option><option value="hybrid-trap">Hybrid Trap Kit</option><option value="minimal-trap">Minimal Trap Kit</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="punchy-808">Punchy 808</option><option value="distorted-kick">Distorted Kick</option><option value="sub-kick">Sub Kick</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="sharp-snare">Sharp Snare</option><option value="heavy-clap">Heavy Clap</option><option value="rim-shot">Rim Shot</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="fast-rolls">Fast Rolls</option><option value="triplet-hats">Triplet Hats</option><option value="open-hat-sync">Open Hat Syncopation</option></select></td>
                    <td class="data-cell rhythm hidden"><select><option value="">Select...</option><option value="vocal-chants">Vocal Chants</option><option value="triangle-pings">Triangle Pings</option><option value="syncopated-perc">Syncopated Perc</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="sliding-808">Sliding 808</option><option value="reese-bass">Reese Bass</option><option value="sub-bass">Sub-Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="gliding-808">Gliding 808 Pattern</option><option value="syncopated-sub">Syncopated Sub</option><option value="minimal-bass">Minimal Bass</option></select></td>
                    <td class="data-cell bass hidden"><select><option value="">Select...</option><option value="heavy-saturation">Heavy Saturation</option><option value="clean-sub">Clean Sub</option><option value="distorted-mid">Distorted Mid-Range</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="dark-synth-lead">Dark Synth Lead</option><option value="melodic-bell">Melodic Bell</option><option value="sampled-melody">Sampled Melody</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="minor-key-arp">Minor Key Arpeggio</option><option value="dark-pads">Dark Pads</option><option value="simple-ostinato">Simple Ostinato</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="tense-buildup">Tense Buildup</option><option value="dramatic-release">Dramatic Release</option><option value="hypnotic-loop">Hypnotic Loop</option></select></td>
                    <td class="data-cell melodic hidden"><select><option value="">Select...</option><option value="synth-brass">Synth Brass Stabs</option><option value="vocal-chops">Vocal Chops</option><option value="string-pads">String Pads</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="dark-ambient-pads">Dark Ambient Pads</option><option value="reverb-drones">Reverb Drones</option><option value="filtered-noise">Filtered Noise</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="pitched-ad-libs">Pitched Ad-libs</option><option value="gang-vocals">Gang Vocals</option><option value="processed-vocals">Heavily Processed Vocals</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="risers-and-falls">Risers and Falls</option><option value="impact-sounds">Impact Sounds</option><option value="gun-shots">Gun Shots / Reloads</option></select></td>
                    <td class="data-cell texture hidden"><select><option value="">Select...</option><option value="wide-stereo-field">Wide Stereo Field</option><option value="cavernous-reverb">Cavernous Reverb</option><option value="delay-throws">Delay Throws</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="loud-and-punchy">Loud and Punchy</option><option value="dark-and-gritty">Dark and Gritty</option><option value="polished-mainstream">Polished Mainstream</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="heavy-sidechain">Heavy Sidechain</option><option value="multiband-distortion">Multiband Distortion</option><option value="stereo-imaging">Stereo Imaging FX</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="aggressive-and-dark">Aggressive &amp; Dark</option><option value="energetic-and-hype">Energetic and Hype</option><option value="melancholic-and-wavy">Melancholic and Wavy</option></select></td>
                    <td class="data-cell production hidden"><select><option value="">Select...</option><option value="2010s-trap">2010s Trap</option><option value="modern-soundcloud">Modern Soundcloud</option><option value="future-trap">Future Trap</option></select></td>
                </tr>
            </tbody>
        </table>
        
        <div id="promptOutput" style="display:none; margin-top: 30px;">
            <div class="clean-prompt" id="cleanPromptSection">
                <h3>Clean Prompt (Ready to Copy)</h3>
                <button class="copy-btn" onclick="copyToClipboard()">Copy to Clipboard</button>
                <div class="clean-prompt-text" id="cleanPromptText"></div>
            </div>
            
            <div class="divider"></div>
            
            <div class="detailed-breakdown">
                <h3>Detailed Breakdown by Style</h3>
                <div id="detailedBreakdown"></div>
            </div>
        </div>
    </div>

    <script>
        // Track which sections are expanded
        const sectionStates = {
            core: false,
            rhythm: false,
            bass: false,
            melodic: false,
            texture: false,
            production: false
        };
        
        let selectedStyles = new Set(['all']);

        function toggleAdvancedControls() {
            const content = document.querySelector('.advanced-controls-content');
            const icon = document.querySelector('.advanced-controls-header .toggle-icon');
            content.classList.toggle('collapsed');
            if (content.classList.contains('collapsed')) {
                icon.textContent = '+';
            } else {
                icon.textContent = '-';
            }
        }

        function toggleStyle(styleName, btn) {
            const allStylesBtn = document.querySelector('.tab-button[data-tab="all"]');
            if (styleName === 'all') {
                if (selectedStyles.has('all') && selectedStyles.size === 1) {
                    selectedStyles.clear();
                    document.querySelectorAll('.tab-button:not([data-tab="all"])').forEach(b => selectedStyles.add(b.dataset.tab));
                } else {
                    selectedStyles.clear();
                    selectedStyles.add('all');
                }
            } else {
                selectedStyles.delete('all');
                if (selectedStyles.has(styleName)) {
                    selectedStyles.delete(styleName);
                } else {
                    selectedStyles.add(styleName);
                }
            }

            updateTabButtons();
            updateRowVisibility();
            saveSelectedStyles();
        }

        function updateTabButtons() {
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(btn => {
                const style = btn.dataset.tab;
                if (selectedStyles.has(style)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            if (selectedStyles.size === 0) {
                const allStylesBtn = document.querySelector('.tab-button[data-tab="all"]');
                allStylesBtn.classList.add('active');
                selectedStyles.add('all');
            }
        }

        function updateRowVisibility() {
            const rows = document.querySelectorAll('tbody tr[data-style]');
            rows.forEach(row => {
                const style = row.dataset.style;
                if (selectedStyles.has('all') || selectedStyles.has(style)) {
                    row.classList.remove('tab-hidden');
                    row.classList.add('tab-visible');
                } else {
                    row.classList.remove('tab-visible');
                    row.classList.add('tab-hidden');
                }
            });
        }

        function saveSelectedStyles() {
            localStorage.setItem('musicPromptSelectedStyles', JSON.stringify(Array.from(selectedStyles)));
        }

        function loadSelectedStyles() {
            const saved = localStorage.getItem('musicPromptSelectedStyles');
            if (saved) {
                const parsed = JSON.parse(saved);
                if (parsed.length > 0) {
                    selectedStyles = new Set(parsed);
                } else {
                    selectedStyles = new Set(['all']);
                }
            } else {
                selectedStyles = new Set(['all']);
            }
            updateTabButtons();
            updateRowVisibility();
        }

        // Track current active tab (legacy, now handled by selectedStyles)
        let currentTab = 'all';
        
        // Phase 2: Enhanced toggle with animations and preferences
        function toggleSection(sectionName) {
            sectionStates[sectionName] = !sectionStates[sectionName];
            updateSectionVisibility(sectionName);
            updateSelectionBadges();
            savePreferences();
        }
        
        function updateSectionVisibility(sectionName) {
            const isExpanded = sectionStates[sectionName];
            const header = document.querySelector(`.section-header.${sectionName}`);
            const columnHeaders = document.querySelectorAll(`.column-header.${sectionName}`);
            const dataCells = document.querySelectorAll(`.data-cell.${sectionName}`);
            const icon = header.querySelector('.toggle-icon');
            
            if (isExpanded) {
                header.classList.remove('collapsed');
                header.classList.add('expanded');
                if(icon) icon.textContent = '-';
                if(icon) icon.classList.remove('rotated');
                
                columnHeaders.forEach(col => col.classList.remove('hidden'));
                dataCells.forEach(cell => cell.classList.remove('hidden'));
                
                // Update colspan
                const colspan = columnHeaders.length;
                header.setAttribute('colspan', colspan);
            } else {
                header.classList.add('collapsed');
                header.classList.remove('expanded');
                if(icon) icon.textContent = '+';
                if(icon) icon.classList.add('rotated');
                
                columnHeaders.forEach(col => col.classList.add('hidden'));
                dataCells.forEach(cell => cell.classList.add('hidden'));
                
                // Set colspan to 1 when collapsed
                header.setAttribute('colspan', '1');
            }
        }
        
        // Focus Mode functionality
        function focusOnSection(targetSection) {
            const sections = ['core', 'rhythm', 'bass', 'melodic', 'texture', 'production'];
            
            // Add focus mode class to container
            document.querySelector('.container').classList.add('focus-mode-active');
            
            sections.forEach(section => {
                const header = document.querySelector(`.section-header.${section}`);
                if (section === targetSection) {
                    // Expand target section
                    if (!sectionStates[section]) {
                        sectionStates[section] = true;
                        updateSectionVisibility(section);
                    }
                    header.classList.add('focused');
                } else {
                    // Collapse other sections
                    if (sectionStates[section]) {
                        sectionStates[section] = false;
                        updateSectionVisibility(section);
                    }
                    header.classList.remove('focused');
                }
            });
            
            // Smooth scroll to focused section
            setTimeout(() => {
                document.querySelector(`.section-header.${targetSection}`).scrollIntoView({
                    behavior: 'smooth',
                    block: 'start',
                    inline: 'nearest'
                });
            }, 300);
            
            updateSelectionBadges();
            savePreferences();
        }
        
        // Selection badge functionality
        function updateSelectionBadges() {
            const sections = ['core', 'rhythm', 'bass', 'melodic', 'texture', 'production'];
            
            sections.forEach(section => {
                const selects = document.querySelectorAll(`.data-cell.${section} select`);
                let count = 0;
                
                selects.forEach(select => {
                    if (select.value && select.value !== '') {
                        count++;
                    }
                });
                
                const badge = document.querySelector(`.section-header.${section} .selection-badge`);
                if (badge) {
                    badge.textContent = count;
                    badge.style.display = (!sectionStates[section] && count > 0) ? 'inline-block' : 'none';
                }
            });
        }
        
        // localStorage functionality
        function savePreferences() {
            try {
                const preferences = {
                    sectionStates: sectionStates,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('musicPromptPreferences', JSON.stringify(preferences));
            } catch (e) {
                console.warn('Could not save preferences to localStorage:', e);
            }
        }
        
        function loadPreferences() {
            try {
                const saved = localStorage.getItem('musicPromptPreferences');
                if (saved) {
                    const preferences = JSON.parse(saved);
                    if (preferences.sectionStates) {
                        // Update sectionStates with saved values
                        Object.keys(preferences.sectionStates).forEach(section => {
                            if (section in sectionStates) {
                                sectionStates[section] = preferences.sectionStates[section];
                            }
                        });
                    }
                }
            } catch (e) {
                console.warn('Could not load preferences from localStorage:', e);
            }
        }
        
        function toggleAllSections() {
            const allExpanded = Object.values(sectionStates).every(state => state);
            
            // Clear focus mode if active
            document.querySelector('.container').classList.remove('focus-mode-active');
            document.querySelectorAll('.section-header').forEach(header => {
                header.classList.remove('focused');
            });
            
            // Toggle all sections
            Object.keys(sectionStates).forEach(section => {
                sectionStates[section] = !allExpanded;
                updateSectionVisibility(section);
            });
            
            // Update button text
            const btn = document.querySelector('.btn-secondary[onclick="toggleAllSections()"]');
            btn.innerHTML = allExpanded ? 'Expand All' : 'Collapse All';
            
            updateSelectionBadges();
            savePreferences();
        }
        
        function clearAll() {
            if (!confirm('Are you sure you want to clear all selections? This cannot be undone.')) {
                return;
            }
            
            // Clear all selections
            const selects = document.querySelectorAll('select');
            selects.forEach(select => {
                if (select.id !== 'styleSelect') {
                    select.value = '';
                }
            });
            
            // Clear output
            document.getElementById('promptOutput').style.display = 'none';
            document.getElementById('cleanPromptText').textContent = '';
            document.getElementById('detailedBreakdown').textContent = '';
            
            // Reset style selector
            document.getElementById('styleSelect').value = '';
            
            // Update badges
            updateSelectionBadges();
            
            // Clear saved matrix data
            localStorage.removeItem('musicMatrixData');
            
            // Clear focus mode if active
            document.querySelector('.container').classList.remove('focus-mode-active');
            document.querySelectorAll('.section-header').forEach(header => {
                header.classList.remove('focused');
            });
        }
        
        function clearAllSilently() {
    // Clear all selections
    const selects = document.querySelectorAll('select');
    selects.forEach(select => {
        if (select.id !== 'styleSelect') {
            select.value = '';
        }
    });
    
    // Clear output
    document.getElementById('promptOutput').style.display = 'none';
    document.getElementById('cleanPromptText').textContent = '';
    document.getElementById('detailedBreakdown').textContent = '';
    
    // Update badges
    updateSelectionBadges();
    
    // Clear saved matrix data
    localStorage.removeItem('musicMatrixData');
    
    // Clear focus mode if active
    document.querySelector('.container').classList.remove('focus-mode-active');
    document.querySelectorAll('.section-header').forEach(header => {
        header.classList.remove('focused');
    });
}

function generateStylePreset() {
            const styleSelect = document.getElementById('styleSelect');
            const selectedStyle = styleSelect.value;
            
            if (!selectedStyle) {
                alert('Please select a style first!');
                return;
            }
            
            // Clear all first - use the silent version instead
            clearAllSilently();
            // Keep the style selected
            styleSelect.value = selectedStyle;
            
            if (selectedStyle === 'random') {
                // Handle random generation across all styles
                const sections = ['core', 'rhythm', 'bass', 'melodic', 'texture', 'production'];
                
                // For each section, get 4-5 column positions
                const sectionColumnCounts = {
                    'core': 4,
                    'rhythm': 5,
                    'bass': 3,
                    'melodic': 4,
                    'texture': 4,
                    'production': 4
                };
                
                sections.forEach(section => {
                    const columnCount = sectionColumnCounts[section];
                    
                    // For each column position in this section
                    for (let colIndex = 0; colIndex < columnCount; colIndex++) {
                        // Get all select elements at this column position across all rows
                        const allSelectsInColumn = [];
                        const rows = document.querySelectorAll('tbody tr');
                        
                        rows.forEach(row => {
                            const sectionSelects = row.querySelectorAll(`.data-cell.${section} select`);
                            if (sectionSelects[colIndex]) {
                                allSelectsInColumn.push(sectionSelects[colIndex]);
                            }
                        });
                        
                        if (allSelectsInColumn.length > 0) {
                            // Pick a random select from this column
                            const randomSelect = allSelectsInColumn[Math.floor(Math.random() * allSelectsInColumn.length)];
                            
                            // Get available options (skip the first "Select..." option)
                            const options = Array.from(randomSelect.querySelectorAll('option')).slice(1);
                            
                            if (options.length > 0) {
                                // Pick a random option and set its value
                                const randomOption = options[Math.floor(Math.random() * options.length)];
                                randomSelect.value = randomOption.value;
                            }
                        }
                    }
                });
                
            } else {
                // Handle specific styles - randomly select from that style's row
                const row = document.querySelector(`tr[data-style="${selectedStyle}"]`);
                if (!row) return;
                
                const selects = row.querySelectorAll('select');
                selects.forEach(select => {
                    const options = Array.from(select.querySelectorAll('option')).slice(1); // Skip "Select..."
                    if (options.length > 0) {
                        const randomOption = options[Math.floor(Math.random() * options.length)];
                        select.value = randomOption.value;
                    }
                });
            }
            
            // Auto-generate the prompt
            generatePrompt();
        }
        
        
        function exportToCSV() {
            const table = document.getElementById('promptMatrix');
            let csv = [];
            
            // Add section headers
            let sectionRow = ['Style'];
            const sections = ['CORE FOUNDATION', 'RHYTHM SECTION', 'BASS FOUNDATION', 'MELODIC ELEMENTS', 'TEXTURE & ATMOSPHERE', 'PRODUCTION & CHARACTER'];
            const sectionCounts = [4, 5, 3, 4, 4, 4];
            
            for (let i = 0; i < sections.length; i++) {
                for (let j = 0; j < sectionCounts[i]; j++) {
                    sectionRow.push(sections[i]);
                }
            }
            csv.push(sectionRow.join(','));
            
            // Add column headers
            let headerRow = ['Style'];
            const headers = table.querySelectorAll('thead tr:nth-child(2) th');
            for (let i = 1; i < headers.length; i++) {
                if (!headers[i].classList.contains('style-cell')) {
                    headerRow.push(headers[i].textContent.trim());
                }
            }
            csv.push(headerRow.join(','));
            
            // Add data rows
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                let csvRow = [];
                const styleName = row.querySelector('.style-cell').textContent;
                csvRow.push(styleName);
                
                // Get all data cells, including hidden ones
                const cells = row.querySelectorAll('.data-cell');
                cells.forEach(cell => {
                    const select = cell.querySelector('select');
                    if (select) {
                        csvRow.push(select.value || '');
                    }
                });
                csv.push(csvRow.join(','));
            });
            
            // Download CSV
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `music_prompt_matrix_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        
        function generatePrompt() {
            const rows = document.querySelectorAll('tbody tr.tab-visible');
            
            let detailedPrompts = [];
            let allValues = [];
            
            rows.forEach(row => {
                const styleName = row.querySelector('.style-cell').textContent;
                const selects = row.querySelectorAll('select');
                const values = [];
                
                selects.forEach(select => {
                    if (select.value) {
                        values.push(select.value);
                        allValues.push(select.value);
                    }
                });
                
                if (values.length > 0) {
                    detailedPrompts.push(`${styleName}: ${values.join(', ')}`);
                }
            });
            
            if (allValues.length === 0) {
                alert('Please select some options first!');
                return;
            }
            
            // Generate clean prompt (just the values)
            const cleanPrompt = `Create a music track with the following elements: ${allValues.join(', ')}`;
            
            // Generate detailed breakdown
            const detailedBreakdown = `${detailedPrompts.join('\n\n')}`;
            
            // Update the display
            document.getElementById('cleanPromptText').textContent = cleanPrompt;
            document.getElementById('detailedBreakdown').textContent = detailedBreakdown;
            document.getElementById('promptOutput').style.display = 'block';
            
            // Auto-select the clean prompt text for easy copying
            const range = document.createRange();
            range.selectNode(document.getElementById('cleanPromptText'));
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
        }
        
        function copyToClipboard() {
            const text = document.getElementById('cleanPromptText').textContent;
            
            // Try modern clipboard API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopiedFeedback();
                }).catch(err => {
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }
        
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = '0';
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopiedFeedback();
            } catch (err) {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy to clipboard. Please select and copy manually.');
            }
            
            document.body.removeChild(textArea);
        }
        
        function showCopiedFeedback() {
            const btn = document.querySelector('.copy-btn');
            const originalText = btn.textContent;
            btn.textContent = 'Copied!';
            btn.classList.add('copied');
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('copied');
            }, 2000);
        }
        
        // Tab switching function
        function switchToTab(tabName) {
            currentTab = tabName;
            
            // Update active tab button
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(btn => {
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Show/hide rows based on tab
            const rows = document.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const rowStyle = row.getAttribute('data-style');
                
                if (tabName === 'all') {
                    // Show all rows for "All Styles" tab
                    row.classList.remove('tab-hidden');
                    row.classList.add('tab-visible', 'fade-in');
                } else if (rowStyle === tabName) {
                    // Show only matching style row
                    row.classList.remove('tab-hidden');
                    row.classList.add('tab-visible', 'fade-in');
                } else {
                    // Hide non-matching rows
                    row.classList.remove('tab-visible', 'fade-in');
                    row.classList.add('tab-hidden');
                }
            });
            
            // Remove fade-in class after animation completes
            setTimeout(() => {
                rows.forEach(row => {
                    row.classList.remove('fade-in');
                });
            }, 300);
            
            // Save tab preference to localStorage
            localStorage.setItem('activeTab', tabName);
        }
        
        // Keyboard navigation for tabs
        function setupKeyboardNavigation() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContainer = document.querySelector('.tab-navigation');
            
            // Add tabindex to make buttons focusable
            tabButtons.forEach((btn, index) => {
                btn.setAttribute('tabindex', '0');
                btn.setAttribute('data-index', index);
            });
            
            // Handle keyboard events
            document.addEventListener('keydown', function(e) {
                // Check if we're not in an input field
                if (e.target.tagName === 'SELECT' || e.target.tagName === 'INPUT') {
                    return;
                }
                
                const activeElement = document.activeElement;
                const isTabButton = activeElement && activeElement.classList.contains('tab-button');
                
                // Number keys 1-9 for quick tab switching
                if (e.key >= '1' && e.key <= '9') {
                    const index = parseInt(e.key) - 1;
                    if (tabButtons[index]) {
                        tabButtons[index].click();
                        tabButtons[index].focus();
                        e.preventDefault();
                    }
                }
                
                // Arrow key navigation when a tab button is focused
                if (isTabButton) {
                    const currentIndex = parseInt(activeElement.getAttribute('data-index'));
                    let newIndex = currentIndex;
                    
                    switch(e.key) {
                        case 'ArrowLeft':
                            newIndex = currentIndex > 0 ? currentIndex - 1 : tabButtons.length - 1;
                            break;
                        case 'ArrowRight':
                            newIndex = currentIndex < tabButtons.length - 1 ? currentIndex + 1 : 0;
                            break;
                        case 'Home':
                            newIndex = 0;
                            break;
                        case 'End':
                            newIndex = tabButtons.length - 1;
                            break;
                        case 'Enter':
                        case ' ':
                            activeElement.click();
                            e.preventDefault();
                            return;
                        default:
                            return;
                    }
                    
                    if (newIndex !== currentIndex) {
                        tabButtons[newIndex].focus();
                        tabButtons[newIndex].click();
                        
                        // Ensure the focused button is visible in the container
                        const buttonRect = tabButtons[newIndex].getBoundingClientRect();
                        const containerRect = tabContainer.getBoundingClientRect();
                        
                        if (buttonRect.left < containerRect.left) {
                            tabContainer.scrollLeft -= containerRect.left - buttonRect.left + 20;
                        } else if (buttonRect.right > containerRect.right) {
                            tabContainer.scrollLeft += buttonRect.right - containerRect.right + 20;
                        }
                        
                        e.preventDefault();
                    }
                }
                
                // Alt+T to focus on tab navigation
                if (e.altKey && e.key.toLowerCase() === 't') {
                    const activeTab = document.querySelector('.tab-button.active');
                    if (activeTab) {
                        activeTab.focus();
                        e.preventDefault();
                    }
                }
            });
        }
        
        // Touch swipe support for mobile
        function setupTouchSupport() {
            const tabContainer = document.querySelector('.tab-navigation');
            const tabButtons = document.querySelectorAll('.tab-button');
            let touchStartX = 0;
            let touchEndX = 0;
            
            tabContainer.addEventListener('touchstart', function(e) {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });
            
            tabContainer.addEventListener('touchend', function(e) {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > swipeThreshold) {
                    const currentIndex = Array.from(tabButtons).findIndex(btn => btn.classList.contains('active'));
                    let newIndex = currentIndex;
                    
                    if (diff > 0) {
                        // Swipe left - next tab
                        newIndex = currentIndex < tabButtons.length - 1 ? currentIndex + 1 : currentIndex;
                    } else {
                        // Swipe right - previous tab
                        newIndex = currentIndex > 0 ? currentIndex - 1 : currentIndex;
                    }
                    
                    if (newIndex !== currentIndex) {
                        tabButtons[newIndex].click();
                        
                        // Scroll the new tab into view
                        tabButtons[newIndex].scrollIntoView({
                            behavior: 'smooth',
                            block: 'nearest',
                            inline: 'center'
                        });
                    }
                }
            }
        }
        
        // Initialize collapsed state and restore tab on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved preferences first
            loadPreferences();
            loadSelectedStyles();
            initializeFusionToggles();
            
            // Initialize section visibility based on loaded preferences
            Object.keys(sectionStates).forEach(section => {
                updateSectionVisibility(section);
            });
            
            // Initialize selection badges
            updateSelectionBadges();
            
            // Add event listeners for selection changes to update badges
            document.querySelectorAll('select').forEach(select => {
                select.addEventListener('change', function() {
                    updateSelectionBadges();
                    // Also save matrix data when selections change
                    saveMatrixData();
                });
            });
            
            // Setup keyboard navigation
            setupKeyboardNavigation();
            
            // Setup touch support for mobile
            if ('ontouchstart' in window) {
                setupTouchSupport();
            }
            
            // Load saved matrix data
            loadMatrixData();
        });
        
        // Save matrix data to localStorage
        function saveMatrixData() {
            try {
                const matrixData = {};
                const rows = document.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const styleName = row.getAttribute('data-style');
                    const rowData = {};
                    const selects = row.querySelectorAll('select');
                    
                    selects.forEach((select, index) => {
                        if (select.value) {
                            rowData[index] = select.value;
                        }
                    });
                    
                    if (Object.keys(rowData).length > 0) {
                        matrixData[styleName] = rowData;
                    }
                });
                
                localStorage.setItem('musicMatrixData', JSON.stringify(matrixData));
            } catch (e) {
                console.warn('Could not save matrix data:', e);
            }
        }
        
        // Load matrix data from localStorage
        function loadMatrixData() {
            try {
                const saved = localStorage.getItem('musicMatrixData');
                if (saved) {
                    const matrixData = JSON.parse(saved);
                    
                    Object.keys(matrixData).forEach(styleName => {
                        const row = document.querySelector(`tr[data-style="${styleName}"]`);
                        if (row) {
                            const selects = row.querySelectorAll('select');
                            const rowData = matrixData[styleName];
                            
                            Object.keys(rowData).forEach(index => {
                                if (selects[index]) {
                                    selects[index].value = rowData[index];
                                }
                            });
                        }
                    });
                    
                    // Update badges after loading data
                    updateSelectionBadges();
                }
            } catch (e) {
                console.warn('Could not load matrix data:', e);
            }
        }
        
        // ==================== PRESET MANAGEMENT SYSTEM ====================
        
        // Get current matrix state for preset saving
        function getCurrentMatrixState() {
            const matrixData = {};
            const rows = document.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const styleName = row.getAttribute('data-style');
                const rowData = {};
                const selects = row.querySelectorAll('select');
                
                selects.forEach((select, index) => {
                    if (select.value) {
                        rowData[index] = select.value;
                    }
                });
                
                if (Object.keys(rowData).length > 0) {
                    matrixData[styleName] = rowData;
                }
            });
            
            return matrixData;
        }
        
        // Apply matrix state from preset
        function applyMatrixState(matrixData) {
            // Clear all selections first
            const allSelects = document.querySelectorAll('tbody select');
            allSelects.forEach(select => {
                select.value = '';
            });
            
            // Apply preset data
            Object.keys(matrixData).forEach(styleName => {
                const row = document.querySelector(`tr[data-style="${styleName}"]`);
                if (row) {
                    const selects = row.querySelectorAll('select');
                    const rowData = matrixData[styleName];
                    
                    Object.keys(rowData).forEach(index => {
                        if (selects[index]) {
                            selects[index].value = rowData[index];
                        }
                    });
                }
            });
            
            // Update UI
            updateSelectionBadges();
            saveMatrixData();
        }
        
        // Get all presets from localStorage
        function getPresets() {
            try {
                const saved = localStorage.getItem('musicPromptPresets');
                return saved ? JSON.parse(saved) : [];
            } catch (e) {
                console.warn('Could not load presets:', e);
                return [];
            }
        }
        
        // Save presets to localStorage
        function savePresetsToStorage(presets) {
            try {
                localStorage.setItem('musicPromptPresets', JSON.stringify(presets));
                return true;
            } catch (e) {
                console.error('Could not save presets:', e);
                showToast('Error saving presets. Storage may be full.', 'error');
                return false;
            }
        }
        
        // Save current configuration as preset
        function savePreset() {
            const nameInput = document.getElementById('presetName');
            const favoriteCheckbox = document.getElementById('presetFavorite');
            const name = nameInput.value.trim();
            
            if (!name) {
                showToast('Please enter a preset name', 'warning');
                nameInput.focus();
                return;
            }
            
            const matrixState = getCurrentMatrixState();
            
            if (Object.keys(matrixState).length === 0) {
                showToast('No selections to save', 'warning');
                closeSavePresetModal();
                return;
            }
            
            const preset = {
                id: Date.now().toString(),
                name: name,
                timestamp: new Date().toISOString(),
                isFavorite: favoriteCheckbox.checked,
                lastUsed: null,
                styleSelections: matrixState,
                sectionStates: { ...sectionStates },
                activeTab: Array.from(selectedStyles) // Save multi-select state
            };
            
            const presets = getPresets();
            
            // Check for duplicate names
            const existingIndex = presets.findIndex(p => p.name === name);
            if (existingIndex !== -1) {
                if (!confirm(`A preset named "${name}" already exists. Do you want to replace it?`)) {
                    return;
                }
                presets[existingIndex] = preset;
            } else {
                presets.push(preset);
            }
            
            if (savePresetsToStorage(presets)) {
                showToast(`Preset "${name}" saved successfully!`, 'success');
                closeSavePresetModal();
                updatePresetDropdown();
                
                // Add to history
                addToHistory(name);
            }
        }
        
        // Load selected preset
        function loadSelectedPreset() {
            const dropdown = document.getElementById('presetDropdown');
            const presetId = dropdown.value;
            
            if (!presetId) {
                showToast('Please select a preset to load', 'warning');
                return;
            }
            
            const presets = getPresets();
            const preset = presets.find(p => p.id === presetId);
            
            if (!preset) {
                showToast('Preset not found', 'error');
                updatePresetDropdown();
                return;
            }
            
            // Check if there are current selections
            const currentState = getCurrentMatrixState();
            if (Object.keys(currentState).length > 0) {
                if (!confirm('Loading this preset will replace your current selections. Continue?')) {
                    return;
                }
            }
            
            // Apply preset
            applyMatrixState(preset.styleSelections);
            
            // Restore section states if available
            if (preset.sectionStates) {
                Object.keys(preset.sectionStates).forEach(section => {
                    if (section in sectionStates) {
                        sectionStates[section] = preset.sectionStates[section];
                        updateSectionVisibility(section);
                    }
                });
            }
            
            // Restore tab if available
            if (preset.activeTab) {
                selectedStyles = new Set(preset.activeTab);
                updateTabButtons();
                updateRowVisibility();
            }
            
            // Update last used timestamp
            preset.lastUsed = new Date().toISOString();
            savePresetsToStorage(presets);
            
            showToast(`Loaded preset: ${preset.name}`, 'success');
            
            // Show preset info
            showPresetInfo(preset);
        }
        
        // Delete selected preset
        function deleteSelectedPreset() {
            const dropdown = document.getElementById('presetDropdown');
            const presetId = dropdown.value;
            
            if (!presetId) {
                showToast('Please select a preset to delete', 'warning');
                return;
            }
            
            const presets = getPresets();
            const preset = presets.find(p => p.id === presetId);
            
            if (!preset) {
                showToast('Preset not found', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete the preset "${preset.name}"?`)) {
                return;
            }
            
            const filteredPresets = presets.filter(p => p.id !== presetId);
            
            if (savePresetsToStorage(filteredPresets)) {
                showToast(`Deleted preset: ${preset.name}`, 'success');
                dropdown.value = '';
                updatePresetDropdown();
                hidePresetInfo();
            }
        }
        
        // Export presets to JSON file
        function exportPresets() {
            const presets = getPresets();
            
            if (presets.length === 0) {
                showToast('No presets to export', 'warning');
                return;
            }
            
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                presets: presets
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `music_prompt_presets_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showToast(`Exported ${presets.length} preset(s)`, 'success');
        }
        
        // Import presets from JSON file
        function importPresets(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    if (!importData.presets || !Array.isArray(importData.presets)) {
                        throw new Error('Invalid preset file format');
                    }
                    
                    const currentPresets = getPresets();
                    let imported = 0;
                    let skipped = 0;
                    
                    importData.presets.forEach(preset => {
                        // Generate new ID to avoid conflicts
                        preset.id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                        
                        // Check for duplicate names
                        const existing = currentPresets.find(p => p.name === preset.name);
                        if (existing) {
                            preset.name = preset.name + ' (imported)';
                            skipped++;
                        }
                        
                        currentPresets.push(preset);
                        imported++;
                    });
                    
                    if (savePresetsToStorage(currentPresets)) {
                        showToast(`Imported ${imported} preset(s)${skipped > 0 ? `, ${skipped} renamed to avoid duplicates` : ''}`, 'success');
                        updatePresetDropdown();
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    showToast('Failed to import presets. Invalid file format.', 'error');
                }
            };
            
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }
        
        // Update preset dropdown with current presets
        function updatePresetDropdown() {
            const presets = getPresets();
            const favoritesGroup = document.getElementById('favoritesGroup');
            const userPresetsGroup = document.getElementById('userPresetsGroup');
            const historyGroup = document.getElementById('historyGroup');
            
            // Clear existing options
            favoritesGroup.innerHTML = '';
            userPresetsGroup.innerHTML = '';
            historyGroup.innerHTML = '';
            
            // Sort presets
            const favorites = presets.filter(p => p.isFavorite).sort((a, b) => 
                new Date(b.lastUsed || b.timestamp) - new Date(a.lastUsed || a.timestamp)
            );
            
            const regular = presets.filter(p => !p.isFavorite).sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            // Add favorites
            favorites.forEach(preset => {
                const option = document.createElement('option');
                option.value = preset.id;
                option.textContent = ` ${preset.name}`;
                favoritesGroup.appendChild(option);
            });
            
            // Add regular presets
            regular.forEach(preset => {
                const option = document.createElement('option');
                option.value = preset.id;
                option.textContent = preset.name;
                userPresetsGroup.appendChild(option);
            });
            
            // Load history
            const history = getHistory();
            history.forEach(item => {
                const option = document.createElement('option');
                option.value = `history_${item.id}`;
                option.textContent = ` ${item.name} (${new Date(item.timestamp).toLocaleString()})`;
                historyGroup.appendChild(option);
            });
            
            // Hide empty groups
            favoritesGroup.style.display = favorites.length === 0 ? 'none' : '';
            userPresetsGroup.style.display = regular.length === 0 ? 'none' : '';
            historyGroup.style.display = history.length === 0 ? 'none' : '';
        }
        
        // Show/hide preset modal
        function showSavePresetModal() {
            const modal = document.getElementById('savePresetModal');
            const nameInput = document.getElementById('presetName');
            const favoriteCheckbox = document.getElementById('presetFavorite');
            
            // Reset form
            nameInput.value = '';
            favoriteCheckbox.checked = false;
            
            // Show modal
            modal.style.display = 'block';
            setTimeout(() => {
                nameInput.focus();
            }, 100);
        }
        
        function closeSavePresetModal() {
            const modal = document.getElementById('savePresetModal');
            modal.style.display = 'none';
        }
        
        // Show preset information
        function showPresetInfo(preset) {
            const infoDiv = document.getElementById('presetInfo');
            const metadataSpan = document.getElementById('presetMetadata');
            
            const created = new Date(preset.timestamp).toLocaleDateString();
            const lastUsed = preset.lastUsed ? new Date(preset.lastUsed).toLocaleDateString() : 'Never';
            const selectionsCount = Object.values(preset.styleSelections).reduce((acc, style) => 
                acc + Object.keys(style).length, 0
            );
            
            metadataSpan.textContent = `Created: ${created} | Last used: ${lastUsed} | ${selectionsCount} selections`;
            infoDiv.style.display = 'block';
        }
        
        function hidePresetInfo() {
            document.getElementById('presetInfo').style.display = 'none';
        }
        
        // Toast notification system
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            toast.style.cssText = `
                padding: 12px 20px;
                margin-bottom: 10px;
                border-radius: 2px;
                color: white;
                font-size: 14px;
                font-weight: 500;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                max-width: 300px;
            `;
            
            switch(type) {
                case 'success':
                    toast.style.background = 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)';
                    break;
                case 'error':
                    toast.style.background = 'linear-gradient(135deg, #f56565 0%, #e53e3e 100%)';
                    break;
                case 'warning':
                    toast.style.background = 'linear-gradient(135deg, #ed8936 0%, #dd6b20 100%)';
                    break;
                default:
                    toast.style.background = 'linear-gradient(135deg, #4a5568 0%, #2d3748 100%)';
            }
            
            toast.textContent = message;
            container.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            }, 10);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    container.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        // History management
        function getHistory() {
            try {
                const saved = localStorage.getItem('promptHistory');
                return saved ? JSON.parse(saved) : [];
            } catch (e) {
                return [];
            }
        }
        
        function addToHistory(name) {
            const history = getHistory();
            const historyItem = {
                id: Date.now().toString(),
                name: name || `Generation ${new Date().toLocaleTimeString()}`,
                timestamp: new Date().toISOString(),
                styleSelections: getCurrentMatrixState()
            };
            
            history.unshift(historyItem);
            
            // Keep only last 10 items
            if (history.length > 10) {
                history.splice(10);
            }
            
            try {
                localStorage.setItem('promptHistory', JSON.stringify(history));
            } catch (e) {
                console.warn('Could not save history:', e);
            }
        }

        function initializeFusionToggles() {
            const container = document.getElementById('fusionStyleToggles');
            const styles = Array.from(document.querySelectorAll('.tab-button:not([data-tab="all"]) ')).map(btn => ({
                id: btn.dataset.tab,
                name: btn.textContent
            }));

            container.innerHTML = '';
            styles.forEach(style => {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = style.id;
                checkbox.addEventListener('change', validateFusionSelection);
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(style.name));
                container.appendChild(label);
            });
        }

        function validateFusionSelection() {
            const checkboxes = document.querySelectorAll('#fusionStyleToggles input:checked');
            const btn = document.getElementById('generateFusionBtn');
            btn.disabled = checkboxes.length < 2 || checkboxes.length > 3;
        }

        function generateFusion() {
            const selected = Array.from(document.querySelectorAll('#fusionStyleToggles input:checked')).map(cb => cb.value);
            if (selected.length < 2 || selected.length > 3) {
                showToast('Please select 2 or 3 styles to fuse.', 'warning');
                return;
            }

            clearAllSilently();

            const [styleA, styleB, styleC] = selected;

            const distribution = {
                core: styleA,
                rhythm: styleB,
                bass: styleC || styleA, // Fallback to A if C is not present
                melodic: styleA,
                texture: styleB,
                production: styleC || styleB // Fallback to B if C is not present
            };

            Object.entries(distribution).forEach(([section, styleId]) => {
                const row = document.querySelector(`tr[data-style="${styleId}"]`);
                if (!row) return;

                const sourceSelects = row.querySelectorAll(`.data-cell.${section} select`);
                sourceSelects.forEach((sourceSelect, index) => {
                    const options = Array.from(sourceSelect.options).filter(opt => opt.value !== '');
                    if (options.length > 0) {
                        const randomOption = options[Math.floor(Math.random() * options.length)];
                        const targetRow = document.querySelector(`tr[data-style="${styleId}"]`);
                        const targetSelect = targetRow.querySelectorAll(`.data-cell.${section} select`)[index];
                        if(targetSelect) targetSelect.value = randomOption.value;
                    }
                });
            });

            // Activate the fused styles in the tab view
            selectedStyles.clear();
            selected.forEach(s => selectedStyles.add(s));
            updateTabButtons();
            updateRowVisibility();
            saveSelectedStyles();

            generatePrompt();
            showToast('Fusion prompt generated!', 'success');
        }
        
        // Listen for preset dropdown changes
        document.addEventListener('DOMContentLoaded', function() {
            const dropdown = document.getElementById('presetDropdown');
            dropdown.addEventListener('change', function() {
                const presetId = this.value;
                if (presetId) {
                    if (presetId.startsWith('history_')) {
                        // Load from history
                        const historyId = presetId.replace('history_', '');
                        const history = getHistory();
                        const item = history.find(h => h.id === historyId);
                        if (item) {
                            applyMatrixState(item.styleSelections);
                            showToast(`Loaded from history: ${item.name}`, 'success');
                        }
                    } else {
                        // Show preset info for regular presets
                        const presets = getPresets();
                        const preset = presets.find(p => p.id === presetId);
                        if (preset) {
                            showPresetInfo(preset);
                        }
                    }
                } else {
                    hidePresetInfo();
                }
            });
            
            // Initialize dropdown on load
            updatePresetDropdown();
            
            // Add keyboard support for modal
            document.addEventListener('keydown', function(e) {
                const modal = document.getElementById('savePresetModal');
                if (modal.style.display === 'block' && e.key === 'Escape') {
                    closeSavePresetModal();
                }
            });
        });
        
        // Modify generatePrompt to add to history
        const originalGeneratePrompt = generatePrompt;
        generatePrompt = function() {
            originalGeneratePrompt();
            // Add to history when prompt is generated
            const styleSelect = document.getElementById('styleSelect');
            const styleName = styleSelect.value || 'Mixed';
            addToHistory(`${styleName} - ${new Date().toLocaleTimeString()}`);
            updatePresetDropdown();
        }
    </script>
</body>
</html>